#!/usr/bin/env python3
"""
çµæ´»ç”¨å·¥ç®¡ç†å¹³å° - Macå®Œæ•´ç‰ˆ
åŒ…å«4ä¸ªä¸»è¦åŠŸèƒ½
"""
import sys
import json
from PyQt6.QtWidgets import (
    QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout,
    QPushButton, QLabel, QTextEdit, QTableWidget, QTableWidgetItem,
    QProgressBar, QMessageBox, QTabWidget, QLineEdit, QDateEdit,
    QComboBox, QSpinBox, QGroupBox, QFormLayout, QListWidget,
    QListWidgetItem, QSplitter, QHeaderView
)
from PyQt6.QtCore import Qt, QTimer, QDate
from PyQt6.QtGui import QFont, QColor

class FlexWorkApp(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("çµæ´»ç”¨å·¥æ™ºèƒ½ç®¡ç†å¹³å°")
        self.setGeometry(100, 100, 1200, 800)
        
        # åº”ç”¨æ•°æ®å­˜å‚¨
        self.jobs = []
        self.candidates = []
        self.contracts = []
        
        # è®¾ç½®æ ·å¼
        self.setStyleSheet("""
            QMainWindow {
                background-color: #f8f9fa;
            }
            QTabWidget::pane {
                border: 1px solid #dee2e6;
                background: white;
                border-radius: 8px;
            }
            QTabBar::tab {
                background: #f8f9fa;
                padding: 12px 24px;
                margin-right: 4px;
                border-radius: 6px 6px 0 0;
            }
            QTabBar::tab:selected {
                background: white;
                border-bottom: 3px solid #007aff;
            }
            QPushButton {
                background-color: #007aff;
                color: white;
                padding: 10px 20px;
                border-radius: 6px;
                border: none;
                font-size: 14px;
                font-weight: 500;
            }
            QPushButton:hover {
                background-color: #0056cc;
            }
            QPushButton#success {
                background-color: #34c759;
            }
            QPushButton#warning {
                background-color: #ff9500;
            }
            QPushButton#danger {
                background-color: #ff3b30;
            }
            QGroupBox {
                font-weight: bold;
                border: 2px solid #e9ecef;
                border-radius: 8px;
                margin-top: 10px;
                padding-top: 15px;
            }
            QGroupBox::title {
                subcontrol-origin: margin;
                left: 10px;
                padding: 0 10px 0 10px;
            }
            QTableWidget {
                border: 1px solid #dee2e6;
                border-radius: 6px;
                background: white;
            }
            QTableWidget::item {
                padding: 8px;
            }
        """)
        
        self.init_ui()
        self.load_sample_data()
    
    def init_ui(self):
        """åˆå§‹åŒ–ç•Œé¢"""
        # ä¸­å¤®éƒ¨ä»¶
        central_widget = QWidget()
        self.setCentralWidget(central_widget)
        main_layout = QVBoxLayout(central_widget)
        
        # æ ‡é¢˜
        header = QLabel("ğŸ¤– çµæ´»ç”¨å·¥æ™ºèƒ½ç®¡ç†å¹³å°")
        header.setFont(QFont("Arial", 24, QFont.Weight.Bold))
        header.setAlignment(Qt.AlignmentFlag.AlignCenter)
        header.setStyleSheet("color: #1a1a1a; margin: 20px 0;")
        main_layout.addWidget(header)
        
        # åˆ›å»ºæ ‡ç­¾é¡µ
        self.tabs = QTabWidget()
        
        # 1. æ™ºèƒ½åŒ¹é…æ ‡ç­¾é¡µ
        self.create_matching_tab()
        
        # 2. èŒä½ç®¡ç†æ ‡ç­¾é¡µ
        self.create_jobs_tab()
        
        # 3. å€™é€‰äººç®¡ç†æ ‡ç­¾é¡µ
        self.create_candidates_tab()
        
        # 4. åˆåŒç®¡ç†æ ‡ç­¾é¡µ
        self.create_contracts_tab()
        
        # 5. æ•°æ®åˆ†ææ ‡ç­¾é¡µ
        self.create_analytics_tab()
        
        main_layout.addWidget(self.tabs)
        
        # çŠ¶æ€æ 
        self.status_bar = QLabel("å°±ç»ª | èŒä½: 0 | å€™é€‰äºº: 0 | åˆåŒ: 0")
        self.status_bar.setStyleSheet("background: white; padding: 10px; border-top: 1px solid #dee2e6;")
        main_layout.addWidget(self.status_bar)
    
    def create_matching_tab(self):
        """åˆ›å»ºæ™ºèƒ½åŒ¹é…æ ‡ç­¾é¡µ"""
        tab = QWidget()
        layout = QVBoxLayout(tab)
        
        # æ ‡é¢˜
        title = QLabel("ğŸ” æ™ºèƒ½å²—ä½åŒ¹é…")
        title.setFont(QFont("Arial", 18, QFont.Weight.Bold))
        title.setStyleSheet("color: #007aff; margin: 10px 0;")
        layout.addWidget(title)
        
        # åˆ†å‰²é¢æ¿
        splitter = QSplitter(Qt.Orientation.Horizontal)
        
        # å·¦ä¾§ï¼šè¾“å…¥åŒº
        left_panel = QWidget()
        left_layout = QVBoxLayout(left_panel)
        
        # èŒä½é€‰æ‹©
        job_group = QGroupBox("é€‰æ‹©èŒä½")
        job_form = QFormLayout()
        self.job_combo = QComboBox()
        job_form.addRow("èŒä½:", self.job_combo)
        job_group.setLayout(job_form)
        left_layout.addWidget(job_group)
        
        # åŒ¹é…é€‰é¡¹
        options_group = QGroupBox("åŒ¹é…é€‰é¡¹")
        options_layout = QVBoxLayout()
        
        self.skill_weight = QSpinBox()
        self.skill_weight.setRange(0, 100)
        self.skill_weight.setValue(40)
        options_layout.addWidget(QLabel(f"æŠ€èƒ½æƒé‡: {self.skill_weight.value()}%"))
        options_layout.addWidget(self.skill_weight)
        
        self.exp_weight = QSpinBox()
        self.exp_weight.setRange(0, 100)
        self.exp_weight.setValue(30)
        options_layout.addWidget(QLabel(f"ç»éªŒæƒé‡: {self.exp_weight.value()}%"))
        options_layout.addWidget(self.exp_weight)
        
        self.salary_weight = QSpinBox()
        self.salary_weight.setRange(0, 100)
        self.salary_weight.setValue(20)
        options_layout.addWidget(QLabel(f"è–ªèµ„æƒé‡: {self.salary_weight.value()}%"))
        options_layout.addWidget(self.salary_weight)
        
        options_group.setLayout(options_layout)
        left_layout.addWidget(options_group)
        
        # åŒ¹é…æŒ‰é’®
        match_btn = QPushButton("ğŸš€ å¼€å§‹æ™ºèƒ½åŒ¹é…")
        match_btn.clicked.connect(self.start_ai_matching)
        match_btn.setObjectName("success")
        left_layout.addWidget(match_btn)
        
        left_layout.addStretch()
        
        # ä¸­é—´ï¼šè¿›åº¦å’Œç»“æœ
        center_panel = QWidget()
        center_layout = QVBoxLayout(center_panel)
        
        # è¿›åº¦æ¡
        self.progress_bar = QProgressBar()
        self.progress_bar.setVisible(False)
        center_layout.addWidget(self.progress_bar)
        
        # ç»“æœè¡¨æ ¼
        self.result_table = QTableWidget(0, 5)
        self.result_table.setHorizontalHeaderLabels(["æ’å", "å€™é€‰äºº", "åŒ¹é…åº¦", "æ¨èçº§åˆ«", "æ“ä½œ"])
        self.result_table.horizontalHeader().setSectionResizeMode(QHeaderView.ResizeMode.Stretch)
        center_layout.addWidget(self.result_table)
        
        # å³ä¾§ï¼šAIåˆ†æ
        right_panel = QWidget()
        right_layout = QVBoxLayout(right_panel)
        
        ai_group = QGroupBox("ğŸ¤– AIåˆ†ææŠ¥å‘Š")
        self.ai_text = QTextEdit()
        self.ai_text.setReadOnly(True)
        self.ai_text.setPlaceholderText("AIåˆ†æç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...")
        right_layout.addWidget(self.ai_text)
        
        # æ“ä½œæŒ‰é’®
        action_btn = QPushButton("ğŸ“‹ å¯¼å‡ºåŒ¹é…æŠ¥å‘Š")
        action_btn.clicked.connect(self.export_report)
        right_layout.addWidget(action_btn)
        
        splitter.addWidget(left_panel)
        splitter.addWidget(center_panel)
        splitter.addWidget(right_panel)
        splitter.setSizes([200, 500, 300])
        
        layout.addWidget(splitter)
        
        self.tabs.addTab(tab, "ğŸ¯ æ™ºèƒ½åŒ¹é…")
    
    def create_jobs_tab(self):
        """åˆ›å»ºèŒä½ç®¡ç†æ ‡ç­¾é¡µ"""
        tab = QWidget()
        layout = QVBoxLayout(tab)
        
        # æ ‡é¢˜å’ŒæŒ‰é’®
        header_layout = QHBoxLayout()
        title = QLabel("ğŸ“‹ èŒä½ç®¡ç†")
        title.setFont(QFont("Arial", 18, QFont.Weight.Bold))
        title.setStyleSheet("color: #34c759;")
        
        new_job_btn = QPushButton("â• å‘å¸ƒæ–°èŒä½")
        new_job_btn.clicked.connect(self.show_new_job_dialog)
        
        header_layout.addWidget(title)
        header_layout.addStretch()
        header_layout.addWidget(new_job_btn)
        layout.addLayout(header_layout)
        
        # èŒä½è¡¨æ ¼
        self.jobs_table = QTableWidget(0, 6)
        self.jobs_table.setHorizontalHeaderLabels(["èŒä½åç§°", "è–ªèµ„èŒƒå›´", "å·¥ä½œåœ°ç‚¹", "çŠ¶æ€", "å‘å¸ƒæ—¥æœŸ", "æ“ä½œ"])
        self.jobs_table.horizontalHeader().setSectionResizeMode(QHeaderView.ResizeMode.Stretch)
        layout.addWidget(self.jobs_table)
        
        # ç»Ÿè®¡æ•°æ®
        stats_layout = QHBoxLayout()
        stats = [
            ("å…¨éƒ¨èŒä½", "0", "#007aff"),
            ("æ‹›è˜ä¸­", "0", "#34c759"),
            ("å·²æš‚åœ", "0", "#ff9500"),
            ("å·²ç»“æŸ", "0", "#8e8e93")
        ]
        
        for label, value, color in stats:
            stat_widget = QWidget()
            stat_layout = QVBoxLayout()
            stat_layout.setContentsMargins(20, 10, 20, 10)
            
            value_label = QLabel(value)
            value_label.setStyleSheet(f"font-size: 24px; font-weight: bold; color: {color};")
            
            text_label = QLabel(label)
            text_label.setStyleSheet("color: #666; font-size: 12px;")
            
            stat_layout.addWidget(value_label, alignment=Qt.AlignmentFlag.AlignCenter)
            stat_layout.addWidget(text_label, alignment=Qt.AlignmentFlag.AlignCenter)
            stat_widget.setLayout(stat_layout)
            stat_widget.setStyleSheet("""
                background: white;
                border-radius: 8px;
                border: 1px solid #e9ecef;
            """)
            stats_layout.addWidget(stat_widget)
        
        layout.addLayout(stats_layout)
        
        self.tabs.addTab(tab, "ğŸ“‹ èŒä½ç®¡ç†")
    
    def create_candidates_tab(self):
        """åˆ›å»ºå€™é€‰äººç®¡ç†æ ‡ç­¾é¡µ"""
        tab = QWidget()
        layout = QVBoxLayout(tab)
        
        # æ ‡é¢˜å’Œæœç´¢
        header_layout = QHBoxLayout()
        title = QLabel("ğŸ‘¥ å€™é€‰äººç®¡ç†")
        title.setFont(QFont("Arial", 18, QFont.Weight.Bold))
        title.setStyleSheet("color: #ff9500;")
        
        search_layout = QHBoxLayout()
        search_input = QLineEdit()
        search_input.setPlaceholderText("æœç´¢å€™é€‰äºº...")
        search_btn = QPushButton("æœç´¢")
        
        search_layout.addWidget(search_input)
        search_layout.addWidget(search_btn)
        
        header_layout.addWidget(title)
        header_layout.addStretch()
        header_layout.addLayout(search_layout)
        layout.addLayout(header_layout)
        
        # å€™é€‰äººåˆ—è¡¨
        splitter = QSplitter(Qt.Orientation.Horizontal)
        
        # å·¦ä¾§ï¼šç­›é€‰
        filter_panel = QWidget()
        filter_layout = QVBoxLayout(filter_panel)
        
        # æŠ€èƒ½ç­›é€‰
        skills_group = QGroupBox("æŠ€èƒ½ç­›é€‰")
        skills_layout = QVBoxLayout()
        skills = ["Python", "React", "UI/UX", "é¡¹ç›®ç®¡ç†", "å¸‚åœºè¥é”€"]
        for skill in skills:
            checkbox = QPushButton(f"âœ“ {skill}")
            checkbox.setCheckable(True)
            checkbox.setStyleSheet("""
                QPushButton {
                    text-align: left;
                    padding: 8px;
                    border: none;
                    background: #f8f9fa;
                }
                QPushButton:checked {
                    background: #e3f2fd;
                    color: #007aff;
                }
            """)
            skills_layout.addWidget(checkbox)
        skills_group.setLayout(skills_layout)
        filter_layout.addWidget(skills_group)
        
        # ç»éªŒç­›é€‰
        exp_group = QGroupBox("å·¥ä½œç»éªŒ")
        exp_layout = QVBoxLayout()
        exp_ranges = ["ä¸é™", "1å¹´ä»¥ä¸‹", "1-3å¹´", "3-5å¹´", "5å¹´ä»¥ä¸Š"]
        for exp in exp_ranges:
            radio = QPushButton(f"â—‹ {exp}")
            radio.setCheckable(True)
            radio.setStyleSheet("""
                QPushButton {
                    text-align: left;
                    padding: 8px;
                    border: none;
                    background: #f8f9fa;
                }
                QPushButton:checked {
                    background: #e3f2fd;
                    color: #007aff;
                }
            """)
            if exp == "ä¸é™":
                radio.setChecked(True)
            exp_layout.addWidget(radio)
        exp_group.setLayout(exp_layout)
        filter_layout.addWidget(exp_group)
        
        filter_layout.addStretch()
        
        # å³ä¾§ï¼šå€™é€‰äººè¡¨æ ¼
        candidates_panel = QWidget()
        candidates_layout = QVBoxLayout(candidates_panel)
        
        self.candidates_table = QTableWidget(0, 5)
        self.candidates_table.setHorizontalHeaderLabels(["å§“å", "æŠ€èƒ½", "ç»éªŒ", "æœŸæœ›è–ªèµ„", "çŠ¶æ€"])
        self.candidates_table.horizontalHeader().setSectionResizeMode(QHeaderView.ResizeMode.Stretch)
        candidates_layout.addWidget(self.candidates_table)
        
        # æ“ä½œæŒ‰é’®
        btn_layout = QHBoxLayout()
        view_btn = QPushButton("ğŸ‘ï¸ æŸ¥çœ‹è¯¦æƒ…")
        contact_btn = QPushButton("ğŸ’¬ è”ç³»")
        interview_btn = QPushButton("ğŸ“… å®‰æ’é¢è¯•")
        
        btn_layout.addWidget(view_btn)
        btn_layout.addWidget(contact_btn)
        btn_layout.addWidget(interview_btn)
        candidates_layout.addLayout(btn_layout)
        
        splitter.addWidget(filter_panel)
        splitter.addWidget(candidates_panel)
        splitter.setSizes([200, 600])
        
        layout.addWidget(splitter)
        
        self.tabs.addTab(tab, "ğŸ‘¥ å€™é€‰äººç®¡ç†")
    
    def create_contracts_tab(self):
        """åˆ›å»ºåˆåŒç®¡ç†æ ‡ç­¾é¡µ"""
        tab = QWidget()
        layout = QVBoxLayout(tab)
        
        # æ ‡é¢˜
        title = QLabel("ğŸ“„ åˆåŒç®¡ç†")
        title.setFont(QFont("Arial", 18, QFont.Weight.Bold))
        title.setStyleSheet("color: #af52de; margin: 10px 0;")
        layout.addWidget(title)
        
        # åˆåŒçŠ¶æ€ç­›é€‰
        status_layout = QHBoxLayout()
        status_btns = [
            ("å…¨éƒ¨", None),
            ("å¾…ç­¾ç½²", "warning"),
            ("æ‰§è¡Œä¸­", "success"),
            ("å·²å®Œæˆ", ""),
            ("å·²ç»ˆæ­¢", "danger")
        ]
        
        for text, style in status_btns:
            btn = QPushButton(text)
            if style:
                btn.setObjectName(style)
            btn.setCheckable(True)
            if text == "å…¨éƒ¨":
                btn.setChecked(True)
            status_layout.addWidget(btn)
        
        status_layout.addStretch()
        new_contract_btn = QPushButton("â• æ–°å»ºåˆåŒ")
        new_contract_btn.setObjectName("success")
        status_layout.addWidget(new_contract_btn)
        layout.addLayout(status_layout)
        
        # åˆåŒåˆ—è¡¨
        self.contracts_table = QTableWidget(0, 7)
        self.contracts_table.setHorizontalHeaderLabels([
            "åˆåŒç¼–å·", "èŒä½åç§°", "å€™é€‰äºº", "å¼€å§‹æ—¥æœŸ", "ç»“æŸæ—¥æœŸ", "çŠ¶æ€", "æ“ä½œ"
        ])
        self.contracts_table.horizontalHeader().setSectionResizeMode(QHeaderView.ResizeMode.Stretch)
        layout.addWidget(self.contracts_table)
        
        # æ—¶é—´çº¿
        timeline_group = QGroupBox("ğŸ“… åˆåŒæ—¶é—´çº¿")
        timeline_layout = QVBoxLayout()
        
        # è¿™é‡Œå¯ä»¥æ·»åŠ æ—¶é—´çº¿ç»„ä»¶
        timeline_label = QLabel("åˆåŒæ—¶é—´çº¿å¯è§†åŒ–ï¼ˆå¼€å‘ä¸­ï¼‰")
        timeline_label.setAlignment(Qt.AlignmentFlag.AlignCenter)
        timeline_label.setStyleSheet("color: #666; padding: 40px;")
        timeline_layout.addWidget(timeline_label)
        
        timeline_group.setLayout(timeline_layout)
        layout.addWidget(timeline_group)
        
        self.tabs.addTab(tab, "ğŸ“„ åˆåŒç®¡ç†")
    
    def create_analytics_tab(self):
        """åˆ›å»ºæ•°æ®åˆ†ææ ‡ç­¾é¡µ"""
        tab = QWidget()
        layout = QVBoxLayout(tab)
        
        # æ ‡é¢˜
        title = QLabel("ğŸ“Š æ•°æ®åˆ†æ")
        title.setFont(QFont("Arial", 18, QFont.Weight.Bold))
        title.setStyleSheet("color: #5ac8fa; margin: 10px 0;")
        layout.addWidget(title)
        
        # æ•°æ®å¡ç‰‡
        cards_layout = QHBoxLayout()
        
        cards_data = [
            ("åŒ¹é…æˆåŠŸç‡", "87%", "ğŸ“ˆ", "#34c759"),
            ("å¹³å‡åŒ¹é…æ—¶é—´", "2.3å¤©", "â±ï¸", "#007aff"),
            ("å€™é€‰äººæ»¡æ„åº¦", "4.8/5", "â­", "#ffcc00"),
            ("ä¼ä¸šæ»¡æ„åº¦", "4.6/5", "ğŸ’¼", "#af52de"),
        ]
        
        for label, value, icon, color in cards_data:
            card = QWidget()
            card_layout = QVBoxLayout()
            card_layout.setContentsMargins(20, 20, 20, 20)
            
            icon_label = QLabel(icon)
            icon_label.setStyleSheet(f"font-size: 32px; color: {color};")
            icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)
            
            value_label = QLabel(value)
            value_label.setStyleSheet("font-size: 28px; font-weight: bold; color: #1a1a1a;")
            value_label.setAlignment(Qt.AlignmentFlag.AlignCenter)
            
            text_label = QLabel(label)
            text_label.setStyleSheet("color: #666; font-size: 14px;")
            text_label.setAlignment(Qt.AlignmentFlag.AlignCenter)
            
            card_layout.addWidget(icon_label)
            card_layout.addWidget(value_label)
            card_layout.addWidget(text_label)
            
            card.setLayout(card_layout)
            card.setStyleSheet("""
                background: white;
                border-radius: 12px;
                border: 1px solid #e9ecef;
            """)
            cards_layout.addWidget(card)
        
        layout.addLayout(cards_layout)
        
        # åˆ†ææŠ¥å‘Š
        report_group = QGroupBox("ğŸ“‹ AIåˆ†ææŠ¥å‘Š")
        report_layout = QVBoxLayout()
        
        report_text = QTextEdit()
        report_text.setReadOnly(True)
        report_text.setText("""
        ğŸ“Š æœ¬æœˆå¹³å°æ•°æ®åˆ†ææŠ¥å‘Š
        
        ğŸ”¥ çƒ­é—¨è¶‹åŠ¿ï¼š
        1. å‰ç«¯å¼€å‘å²—ä½éœ€æ±‚å¢é•¿ 35%
        2. è¿œç¨‹å·¥ä½œèŒä½å¢åŠ  42%
        3. çµæ´»ç”¨å·¥å¹³å‡è–ªèµ„ä¸Šæ¶¨ 15%
        
        ğŸ¯ ä¼˜åŒ–å»ºè®®ï¼š
        1. å¢åŠ Pythonã€ReactæŠ€èƒ½åŸ¹è®­
        2. ä¼˜åŒ–è¿œç¨‹åä½œå·¥å…·é›†æˆ
        3. åŠ å¼ºåˆåŒæ¨¡æ¿è§„èŒƒåŒ–
        
        ğŸ’¡ æœºä¼šå‘ç°ï¼š
        1. å¸‚åœºå¯¹AIæŠ€èƒ½éœ€æ±‚ä¸Šå‡
        2. çŸ­è§†é¢‘è¿è¥å²—ä½ç¼ºå£å¤§
        3. è·¨å¢ƒç”µå•†äººæ‰ç´§ç¼º
        """)
        
        report_layout.addWidget(report_text)
        report_group.setLayout(report_layout)
        layout.addWidget(report_group)
        
        # å¯¼å‡ºæŒ‰é’®
        export_btn = QPushButton("ğŸ“¥ å¯¼å‡ºå®Œæ•´æŠ¥å‘Š")
        export_btn.clicked.connect(self.export_analytics)
        layout.addWidget(export_btn)
        
        self.tabs.addTab(tab, "ğŸ“Š æ•°æ®åˆ†æ")
    
    def load_sample_data(self):
        """åŠ è½½ç¤ºä¾‹æ•°æ®"""
        # ç¤ºä¾‹èŒä½æ•°æ®
        self.jobs = [
            {"name": "å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ", "salary": "300-500å…ƒ/å¤©", "location": "è¿œç¨‹", "status": "æ‹›è˜ä¸­"},
            {"name": "UIè®¾è®¡å¸ˆ", "salary": "250-400å…ƒ/å¤©", "location": "ä¸Šæµ·", "status": "æ‹›è˜ä¸­"},
            {"name": "Pythonå¼€å‘", "salary": "350-600å…ƒ/å¤©", "location": "è¿œç¨‹", "status": "æš‚åœ"},
            {"name": "å¸‚åœºè¥é”€", "salary": "200-350å…ƒ/å¤©", "location": "åŒ—äº¬", "status": "ç»“æŸ"},
        ]
        
        # ç¤ºä¾‹å€™é€‰äººæ•°æ®
        self.candidates = [
            {"name": "å¼ ä¸‰", "skills": "Python, Django, React", "exp": "3å¹´", "salary": "400å…ƒ/å¤©", "status": "å¯è”ç³»"},
            {"name": "æå››", "skills": "UI/UX, Figma, Photoshop", "exp": "5å¹´", "salary": "350å…ƒ/å¤©", "status": "é¢è¯•ä¸­"},
            {"name": "ç‹äº”", "skills": "å¸‚åœºè¥é”€, SEO, å†…å®¹è¿è¥", "exp": "2å¹´", "salary": "280å…ƒ/å¤©", "status": "å·²å½•ç”¨"},
            {"name": "èµµå…­", "skills": "React, Vue, Node.js", "exp": "4å¹´", "salary": "450å…ƒ/å¤©", "status": "å¯è”ç³»"},
        ]
        
        # æ›´æ–°UI
        self.update_jobs_table()
        self.update_candidates_table()
        self.update_status_bar()
        
        # å¡«å……èŒä½ä¸‹æ‹‰æ¡†
        for job in self.jobs:
            self.job_combo.addItem(f"{job['name']} - {job['location']}")
    
    def update_jobs_table(self):
        """æ›´æ–°èŒä½è¡¨æ ¼"""
        self.jobs_table.setRowCount(len(self.jobs))
        for i, job in enumerate(self.jobs):
            self.jobs_table.setItem(i, 0, QTableWidgetItem(job["name"]))
            self.jobs_table.setItem(i, 1, QTableWidgetItem(job["salary"]))
            self.jobs_table.setItem(i, 2, QTableWidgetItem(job["location"]))
            
            status_item = QTableWidgetItem(job["status"])
            if job["status"] == "æ‹›è˜ä¸­":
                status_item.setForeground(QColor("#34c759"))
            elif job["status"] == "æš‚åœ":
                status_item.setForeground(QColor("#ff9500"))
            else:
                status_item.setForeground(QColor("#8e8e93"))
            self.jobs_table.setItem(i, 3, status_item)
            
            self.jobs_table.setItem(i, 4, QTableWidgetItem("2024-01-15"))
            
            # æ“ä½œæŒ‰é’®
            action_btn = QPushButton("ç®¡ç†")
            action_btn.setStyleSheet("padding: 5px 10px;")
            self.jobs_table.setCellWidget(i, 5, action_btn)
    
    def update_candidates_table(self):
        """æ›´æ–°å€™é€‰äººè¡¨æ ¼"""
        self.candidates_table.setRowCount(len(self.candidates))
        for i, candidate in enumerate(self.candidates):
            self.candidates_table.setItem(i, 0, QTableWidgetItem(candidate["name"]))
            self.candidates_table.setItem(i, 1, QTableWidgetItem(candidate["skills"]))
            self.candidates_table.setItem(i, 2, QTableWidgetItem(candidate["exp"]))
            self.candidates_table.setItem(i, 3, QTableWidgetItem(candidate["salary"]))
            
            status_item = QTableWidgetItem(candidate["status"])
            if candidate["status"] == "å¯è”ç³»":
                status_item.setForeground(QColor("#007aff"))
            elif candidate["status"] == "é¢è¯•ä¸­":
                status_item.setForeground(QColor("#ff9500"))
            else:
                status_item.setForeground(QColor("#34c759"))
            self.candidates_table.setItem(i, 4, status_item)
    
    def update_status_bar(self):
        """æ›´æ–°çŠ¶æ€æ """
        self.status_bar.setText(
            f"å°±ç»ª | èŒä½: {len(self.jobs)} | å€™é€‰äºº: {len(self.candidates)} | åˆåŒ: {len(self.contracts)}"
        )
    
    def start_ai_matching(self):
        """å¼€å§‹AIåŒ¹é…"""
        if self.job_combo.currentText() == "":
            QMessageBox.warning(self, "æç¤º", "è¯·å…ˆé€‰æ‹©è¦åŒ¹é…çš„èŒä½ï¼")
            return
        
        # æ˜¾ç¤ºè¿›åº¦æ¡
        self.progress_bar.setVisible(True)
        self.progress_bar.setValue(0)
        
        # æ¨¡æ‹ŸåŒ¹é…è¿‡ç¨‹
        self.match_step = 0
        self.match_timer = QTimer()
        self.match_timer.timeout.connect(self.update_matching_progress)
        self.match_timer.start(200)
        
        # æ¸…ç©ºä¹‹å‰çš„ç»“æœ
        self.result_table.setRowCount(0)
        self.ai_text.clear()
    
    def update_matching_progress(self):
        """æ›´æ–°åŒ¹é…è¿›åº¦"""
        self.match_step += 5
        self.progress_bar.setValue(self.match_step)
        
        if self.match_step >= 100:
            self.match_timer.stop()
            self.progress_bar.setVisible(False)
            self.show_matching_results()
    
    def show_matching_results(self):
        """æ˜¾ç¤ºåŒ¹é…ç»“æœ"""
        # æ¨¡æ‹ŸåŒ¹é…ç»“æœ
        results = [
            {"rank": 1, "name": "å¼ ä¸‰", "score": 92, "level": "å¼ºçƒˆæ¨è"},
            {"rank": 2, "name": "æå››", "score": 85, "level": "æ¨è"},
            {"rank": 3, "name": "ç‹äº”", "score": 78, "level": "ä¸€èˆ¬æ¨è"},
            {"rank": 4, "name": "èµµå…­", "score": 65, "level": "è°¨æ…æ¨è"},
            {"rank": 5, "name": "é’±ä¸ƒ", "score": 58, "level": "ä¸æ¨è"},
        ]
        
        # æ›´æ–°è¡¨æ ¼
        self.result_table.setRowCount(len(results))
        for i, result in enumerate(results):
            self.result_table.setItem(i, 0, QTableWidgetItem(str(result["rank"])))
            self.result_table.setItem(i, 1, QTableWidgetItem(result["name"]))
            
            score_item = QTableWidgetItem(f"{result['score']}%")
            if result["score"] >= 85:
                score_item.setForeground(QColor("#34c759"))
            elif result["score"] >= 70:
                score_item.setForeground(QColor("#ff9500"))
            else:
                score_item.setForeground(QColor("#ff3b30"))
            self.result_table.setItem(i, 2, score_item)
            
            level_item = QTableWidgetItem(result["level"])
            self.result_table.setItem(i, 3, level_item)
            
            # æ“ä½œæŒ‰é’®
            action_btn = QPushButton("æŸ¥çœ‹")
            action_btn.setStyleSheet("padding: 5px 15px;")
            self.result_table.setCellWidget(i, 4, action_btn)
        
        # ç”ŸæˆAIåˆ†ææŠ¥å‘Š
        ai_report = f"""
        ğŸ¤– AIåŒ¹é…åˆ†ææŠ¥å‘Š
        {'='*40}
        
        èŒä½ï¼š{self.job_combo.currentText()}
        åŒ¹é…æ—¶é—´ï¼š{QDate.currentDate().toString("yyyy-MM-dd")}
        å‚ä¸åŒ¹é…å€™é€‰äººï¼š{len(self.candidates)}äºº
        
        ğŸ† æœ€ä½³åŒ¹é…å€™é€‰äººï¼š{results[0]['name']}
        åŒ¹é…åˆ†æ•°ï¼š{results[0]['score']}%
        
        ğŸ“Š åŒ¹é…åˆ†å¸ƒï¼š
        â€¢ 85åˆ†ä»¥ä¸Šï¼ˆä¼˜ç§€ï¼‰ï¼š2äºº
        â€¢ 70-85åˆ†ï¼ˆè‰¯å¥½ï¼‰ï¼š1äºº
        â€¢ 60-70åˆ†ï¼ˆä¸€èˆ¬ï¼‰ï¼š1äºº
        â€¢ 60åˆ†ä»¥ä¸‹ï¼ˆä¸è¶³ï¼‰ï¼š1äºº
        
        ğŸ’¡ AIå»ºè®®ï¼š
        1. ç«‹å³è”ç³»å‰3åå€™é€‰äººå®‰æ’é¢è¯•
        2. {results[0]['name']}çš„æŠ€èƒ½ä¸èŒä½è¦æ±‚é«˜åº¦åŒ¹é…
        3. å»ºè®®é‡ç‚¹è€ƒå¯Ÿå€™é€‰äººçš„æ²Ÿé€šèƒ½åŠ›
        
        âš ï¸ æ³¨æ„äº‹é¡¹ï¼š
        1. éªŒè¯å€™é€‰äººçš„å®é™…é¡¹ç›®ç»éªŒ
        2. ç¡®è®¤å¯å·¥ä½œæ—¶é—´å’Œåœ°ç‚¹
        3. æ˜ç¡®è–ªèµ„æœŸæœ›å’Œæ”¯ä»˜æ–¹å¼
        """
        
        self.ai_text.setText(ai_report)
        
        QMessageBox.information(self, "åŒ¹é…å®Œæˆ", f"æ™ºèƒ½åŒ¹é…å®Œæˆï¼æ‰¾åˆ° {len(results)} ä¸ªåˆé€‚çš„å€™é€‰äºº")
    
    def show_new_job_dialog(self):
        """æ˜¾ç¤ºæ–°å»ºèŒä½å¯¹è¯æ¡†"""
        dialog = QDialog(self)
        dialog.setWindowTitle("å‘å¸ƒæ–°èŒä½")
        dialog.setFixedSize(500, 400)
        
        layout = QVBoxLayout()
        
        # è¡¨å•
        form_layout = QFormLayout()
        
        name_input = QLineEdit()
        name_input.setPlaceholderText("ä¾‹å¦‚ï¼šå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ")
        form_layout.addRow("èŒä½åç§°:", name_input)
        
        salary_min = QSpinBox()
        salary_min.setRange(0, 1000)
        salary_min.setSuffix("å…ƒ/å¤©")
        salary_max = QSpinBox()
        salary_max.setRange(0, 1000)
        salary_max.setSuffix("å…ƒ/å¤©")
        
        salary_layout = QHBoxLayout()
        salary_layout.addWidget(salary_min)
        salary_layout.addWidget(QLabel("åˆ°"))
        salary_layout.addWidget(salary_max)
        salary_layout.addStretch()
        form_layout.addRow("è–ªèµ„èŒƒå›´:", salary_layout)
        
        location_combo = QComboBox()
        location_combo.addItems(["è¿œç¨‹", "ä¸Šæµ·", "åŒ—äº¬", "æ·±åœ³", "æ­å·", "å…¶ä»–"])
        form_layout.addRow("å·¥ä½œåœ°ç‚¹:", location_combo)
        
        desc_input = QTextEdit()
        desc_input.setMaximumHeight(100)
        form_layout.addRow("èŒä½æè¿°:", desc_input)
        
        layout.addLayout(form_layout)
        
        # æŒ‰é’®
        button_layout = QHBoxLayout()
        save_btn = QPushButton("ä¿å­˜èŒä½")
        cancel_btn = QPushButton("å–æ¶ˆ")
        
        save_btn.clicked.connect(dialog.accept)
        cancel_btn.clicked.connect(dialog.reject)
        
        button_layout.addStretch()
        button_layout.addWidget(cancel_btn)
        button_layout.addWidget(save_btn)
        
        layout.addLayout(button_layout)
        dialog.setLayout(layout)
        
        if dialog.exec():
            # ä¿å­˜æ–°èŒä½
            new_job = {
                "name": name_input.text(),
                "salary": f"{salary_min.value()}-{salary_max.value()}å…ƒ/å¤©",
                "location": location_combo.currentText(),
                "status": "æ‹›è˜ä¸­"
            }
            self.jobs.append(new_job)
            self.update_jobs_table()
            self.update_status_bar()
            
            # æ›´æ–°ä¸‹æ‹‰æ¡†
            self.job_combo.addItem(f"{new_job['name']} - {new_job['location']}")
            
            QMessageBox.information(self, "æˆåŠŸ", "èŒä½å‘å¸ƒæˆåŠŸï¼")
    
    def export_report(self):
        """å¯¼å‡ºæŠ¥å‘Š"""
        QMessageBox.information(self, "å¯¼å‡º", "åŒ¹é…æŠ¥å‘Šå·²å¯¼å‡ºåˆ°æ¡Œé¢")
    
    def export_analytics(self):
        """å¯¼å‡ºåˆ†ææŠ¥å‘Š"""
        QMessageBox.information(self, "å¯¼å‡º", "æ•°æ®åˆ†ææŠ¥å‘Šå·²å¯¼å‡ºåˆ°æ¡Œé¢")


def main():
    app = QApplication(sys.argv)
    window = FlexWorkApp()
    window.show()
    sys.exit(app.exec())

if __name__ == "__main__":
    main()